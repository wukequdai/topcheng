<%
'========================================================================================================================
'沿途验证码程序 V1.0
'使用方法：
'1、第10-12行，为需要开放的验证码类型；
'2、第23行为 XAOS_Code 验证码设置 
'3、第433行为 XAOS_NumCode 验证码类型设置
'========================================================================================================================

Const mypSN = 0   '定义验证码类型

Select Case mypSN
   Case 0
    	Call XAOS_NumCode("pSN") 	'数字相加(3+4=?)
    	Const myWS = 5  		 	'4:数字相加(13+14=?),5:数字相加(3+4=?)
   Case 1
    	Call XAOS_csCode("pSN")   	'验证空间是否支持(Persits.jpeg)组件
   Case 2
    	Call XAOS_Code("pSN")   	'汉字，纯数字，纯字母，字母数字组合
End Select


ResetClass
Rem #验证码程序
Sub XAOS_Code(pSN)
  Dim nCharNun,codeLen,nCharType,cAmount
  Dim cCode
  Dim nCharNum
  Rem #验证码位数
  nCharNum = 0   '0:4位,1:6位,2:8位
  Rem #验证码类型
  nCharType = 0  '0:大写字母,1:大写字母+数字,2:汉字,3:纯数字
  
  Select Case nCharNum '验证码位数
   Case 0
    codeLen = 4
   Case 1
    codeLen = 6 
   Case 2
    codeLen = 8 
  End Select
  
  Select Case nCharType
   Case 0 '大写字母
     Rem #字库数量
     cAmount = 26
     Rem #字库对应的字符
     cCode = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
     Rem #字符的数据(可以自己修改)
     Dim vNumberData(26)
     vNumberData(0) = "1111111111111111111111111111111111111111111111000111111111111111100000111111111111111000001111111111111110010011111111111111000100011111111111110011100111111111111100111001111111111110001110001111111111100011100011111111111000000000111111111110000000001111111111000000000001111111110011111110011111111100111111100111111110001111111000111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(1) = "1111111111111111111111111111111111111111110000000011111111111100000000001111111111000000000011111111110001111100011111111100011111000111111111000111110011111111110000000000111111111100000000011111111111000000000001111111110001111110011111111100011111100011111111000111111000111111110000000000011111111100000000000111111111000000000111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(2) = "1111111111111111111111111111111111111111111111100011111111111111100000001111111111110000000001111111111000111100001111111110011111101111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111110011111101111111111100011110000111111111100000000011111111111100000001111111111111110001111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(3) = "1111111111111111111111111111111111111111110000000011111111111100000000001111111111000000000011111111110001111100011111111100011111100111111111000111111000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100111111111000111110001111111110000000000011111111100000000001111111111000000001111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(4) = "1111111111111111111111111111111111111111110000000000011111111100000000000111111111000000000001111111110001111111111111111100011111111111111111000111111111111111110000000000111111111100000000001111111111000000000011111111110001111111111111111100011111111111111111000111111111111111110000000000011111111100000000000111111111000000000001111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(5) = "1111111111111111111111111111111111111111110000000000111111111100000000001111111111000000000011111111110001111111111111111100011111111111111111000111111111111111110000000001111111111100000000011111111111000000000111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(6) = "1111111111111111111111111111111111111111111111110001111111111111100000000011111111110000000000011111111000011111000011111110001111111011111111100111111111111111110001111111111111111100011110000000111111000111100000001111111001111000000011111110001111111000111111100001111110001111111100000000000011111111100000000011111111111111000111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(7) = "1111111111111111111111111111111111111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100011111111000111111000111111110000000000001111111100000000000011111111000000000000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100011111111000111111000111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(8) = "1111111111111111111111111111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(9) = "1111111111111111111111111111111111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111100011110001111111111000111100011111111111001111000111111111110000000011111111111110000000111111111111110000111111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(10) = "1111111111111111111111111111111111111111110001111100001111111100011110000111111111000111100011111111110001110001111111111100011000111111111111000100001111111111110000000011111111111100000100111111111111000011100111111111110001111001111111111100011111001111111111000111110011111111110001111110011111111100011111100111111111000111111100111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(11) = "1111111111111111111111111111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110000000000111111111100000000001111111111000000000011111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(12) = "1111111111111111111111111111111111111111110000011111000001111100000111110000011111000001111100000111110000011111000001111100010011100100011111000100111001000111110001101110110001111100011001001100011111000110010011000111110001100100110001111100011000001100011111000111000111000111110001110001110001111100011100011100011111000111000111000111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(13) = "1111111111111111111111111111111111111111110001111110001111111100001111100011111111000011111000111111110000011110001111111100010111100011111111000100111000111111110001101110001111111100011001100011111111000111011000111111110001110010001111111100011110100011111111000111100000111111110001111100001111111100011111000011111111000111111000111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(14) = "1111111111111111111111111111111111111111111111100001111111111111100000000111111111110000000000111111111000111111000111111110011111111001111111000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111110001111110001111111100001111000011111111100000000001111111111100000000111111111111110000111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(15) = "1111111111111111111111111111111111111111110000000011111111111100000000001111111111000000000011111111110001111100011111111100011111000111111111000111110001111111110000000000111111111100000000001111111111000000001111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(16) = "1111111111111111111111111111111111111111111111100001111111111111100000000111111111110000000000111111111000111111000111111110001111111001111111000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111110011110010001111111100011110000011111111100000000001111111111100000000001111111111110000110001111111111111111111011111111111111111111111111111111111111111111"
     vNumberData(17) = "1111111111111111111111111111111111111111110000000011111111111100000000001111111111000000000011111111110001111100011111111100011111000111111111000111110001111111110000000000111111111100000000001111111111000000001111111111110001110001111111111100011110011111111111000111100011111111110001111100111111111100011111000111111111000111111001111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(18) = "1111111111111111111111111111111111111111111110000111111111111110000000011111111111100000000011111111110001111100011111111100011111000111111111000111111111111111111000001111111111111111000000011111111111111110000011111111111111111100011111111100011111000111111111100011110001111111111000000000111111111111000000011111111111111100001111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(19) = "1111111111111111111111111111111111111111110000000000011111111100000000000111111111000000000001111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(20) = "1111111111111111111111111111111111111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100011111111100011110001111111111000000000011111111111000000001111111111111100001111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(21) = "1111111111111111111111111111111111111111100011111110001111111100111111100111111111000111110001111111110001111100011111111110011111001111111111100011100011111111111000111000111111111111001110011111111111110011100111111111111100010001111111111111100100111111111111111000001111111111111110000011111111111111110001111111111111111100011111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(22) = "1111111111111111111111111111111111111111100111110001111100011001111100011111001110011111000111110011100011100000111000111000111001001110001111001110010011100111110011100100111001111100010011100100011111000100111001000111111001001110010011111110000011100000111111100001111100001111111000011111000011111111000111110000111111110001111100011111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(23) = "1111111111111111111111111111111111111111110001111100011111111110011111001111111111100011100011111111111100111001111111111111000100011111111111111000001111111111111111000111111111111111110001111111111111111100011111111111111110000011111111111111000100011111111111110011100111111111111000111000111111111110011111001111111111000111110001111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(24) = "1111111111111111111111111111111111111111100011111110001111111100111111100111111111000111110001111111111001111100111111111111001110011111111111110001000111111111111110000011111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(25) = "1111111111111111111111111111111111111111110000000000111111111100000000001111111111000000000011111111111111110001111111111111111100111111111111111110001111111111111111000111111111111111100011111111111111110001111111111111111000111111111111111110011111111111111111000111111111111111100000000000111111111000000000001111111110000000000011111111111111111111111111111111111111111111111111111111111111111111"
     
   Case 1 '字母+数字
    cAmount = 36
    cCode = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
    ReDim vNumberData(36)
     vNumberData(0) = "1111111111111111111111111111111111111111111111000111111111111111100000111111111111111000001111111111111110010011111111111111000100011111111111110011100111111111111100111001111111111110001110001111111111100011100011111111111000000000111111111110000000001111111111000000000001111111110011111110011111111100111111100111111110001111111000111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(1) = "1111111111111111111111111111111111111111110000000011111111111100000000001111111111000000000011111111110001111100011111111100011111000111111111000111110011111111110000000000111111111100000000011111111111000000000001111111110001111110011111111100011111100011111111000111111000111111110000000000011111111100000000000111111111000000000111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(2) = "1111111111111111111111111111111111111111111111100011111111111111100000001111111111110000000001111111111000111100001111111110011111101111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111110011111101111111111100011110000111111111100000000011111111111100000001111111111111110001111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(3) = "1111111111111111111111111111111111111111110000000011111111111100000000001111111111000000000011111111110001111100011111111100011111100111111111000111111000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100111111111000111110001111111110000000000011111111100000000001111111111000000001111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(4) = "1111111111111111111111111111111111111111110000000000011111111100000000000111111111000000000001111111110001111111111111111100011111111111111111000111111111111111110000000000111111111100000000001111111111000000000011111111110001111111111111111100011111111111111111000111111111111111110000000000011111111100000000000111111111000000000001111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(5) = "1111111111111111111111111111111111111111110000000000111111111100000000001111111111000000000011111111110001111111111111111100011111111111111111000111111111111111110000000001111111111100000000011111111111000000000111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(6) = "1111111111111111111111111111111111111111111111110001111111111111100000000011111111110000000000011111111000011111000011111110001111111011111111100111111111111111110001111111111111111100011110000000111111000111100000001111111001111000000011111110001111111000111111100001111110001111111100000000000011111111100000000011111111111111000111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(7) = "1111111111111111111111111111111111111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100011111111000111111000111111110000000000001111111100000000000011111111000000000000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100011111111000111111000111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(8) = "1111111111111111111111111111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(9) = "1111111111111111111111111111111111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111100011110001111111111000111100011111111111001111000111111111110000000011111111111110000000111111111111110000111111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(10) = "1111111111111111111111111111111111111111110001111100001111111100011110000111111111000111100011111111110001110001111111111100011000111111111111000100001111111111110000000011111111111100000100111111111111000011100111111111110001111001111111111100011111001111111111000111110011111111110001111110011111111100011111100111111111000111111100111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(11) = "1111111111111111111111111111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110000000000111111111100000000001111111111000000000011111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(12) = "1111111111111111111111111111111111111111110000011111000001111100000111110000011111000001111100000111110000011111000001111100010011100100011111000100111001000111110001101110110001111100011001001100011111000110010011000111110001100100110001111100011000001100011111000111000111000111110001110001110001111100011100011100011111000111000111000111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(13) = "1111111111111111111111111111111111111111110001111110001111111100001111100011111111000011111000111111110000011110001111111100010111100011111111000100111000111111110001101110001111111100011001100011111111000111011000111111110001110010001111111100011110100011111111000111100000111111110001111100001111111100011111000011111111000111111000111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(14) = "1111111111111111111111111111111111111111111111100001111111111111100000000111111111110000000000111111111000111111000111111110011111111001111111000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111110001111110001111111100001111000011111111100000000001111111111100000000111111111111110000111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(15) = "1111111111111111111111111111111111111111110000000011111111111100000000001111111111000000000011111111110001111100011111111100011111000111111111000111110001111111110000000000111111111100000000001111111111000000001111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(16) = "1111111111111111111111111111111111111111111111100001111111111111100000000111111111110000000000111111111000111111000111111110001111111001111111000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111110011110010001111111100011110000011111111100000000001111111111100000000001111111111110000110001111111111111111111011111111111111111111111111111111111111111111"
     vNumberData(17) = "1111111111111111111111111111111111111111110000000011111111111100000000001111111111000000000011111111110001111100011111111100011111000111111111000111110001111111110000000000111111111100000000001111111111000000001111111111110001110001111111111100011110011111111111000111100011111111110001111100111111111100011111000111111111000111111001111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(18) = "1111111111111111111111111111111111111111111110000111111111111110000000011111111111100000000011111111110001111100011111111100011111000111111111000111111111111111111000001111111111111111000000011111111111111110000011111111111111111100011111111100011111000111111111100011110001111111111000000000111111111111000000011111111111111100001111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(19) = "1111111111111111111111111111111111111111110000000000011111111100000000000111111111000000000001111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(20) = "1111111111111111111111111111111111111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100011111111000111111000111111110001111110001111111100011111100011111111100011110001111111111000000000011111111111000000001111111111111100001111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(21) = "1111111111111111111111111111111111111111100011111110001111111100111111100111111111000111110001111111110001111100011111111110011111001111111111100011100011111111111000111000111111111111001110011111111111110011100111111111111100010001111111111111100100111111111111111000001111111111111110000011111111111111110001111111111111111100011111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(22) = "1111111111111111111111111111111111111111100111110001111100011001111100011111001110011111000111110011100011100000111000111000111001001110001111001110010011100111110011100100111001111100010011100100011111000100111001000111111001001110010011111110000011100000111111100001111100001111111000011111000011111111000111110000111111110001111100011111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(23) = "1111111111111111111111111111111111111111110001111100011111111110011111001111111111100011100011111111111100111001111111111111000100011111111111111000001111111111111111000111111111111111110001111111111111111100011111111111111110000011111111111111000100011111111111110011100111111111111000111000111111111110011111001111111111000111110001111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(24) = "1111111111111111111111111111111111111111100011111110001111111100111111100111111111000111110001111111111001111100111111111111001110011111111111110001000111111111111110000011111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(25) = "1111111111111111111111111111111111111111110000000000111111111100000000001111111111000000000011111111111111110001111111111111111100111111111111111110001111111111111111000111111111111111100011111111111111110001111111111111111000111111111111111110011111111111111111000111111111111111100000000000111111111000000000001111111110000000000011111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(26) = "1111111111111111111111111111111111111111111111111111111111111111110001111111111111110000000111111111111000000000111111111110001110001111111111100011100011111111110000111000011111111100001110000111111111000011100001111111110000111000011111111100001110000111111111100011100011111111111000111000111111111110000000001111111111110000000111111111111111000111111111111111111111111111111111111111111111111111"
     vNumberData(27) = "1111111111111111111111111111111111111111111111111111111111111111111100011111111111111110000111111111111111000001111111111111100000011111111111100000000111111111111000100001111111111110111000011111111111111110000111111111111111100001111111111111111000011111111111111110000111111111111111100001111111111111111000011111111111111110000111111111111111100001111111111111111111111111111111111111111111111111"
     vNumberData(28) = "1111111111111111111111111111111111111111111111111111111111111111100000111111111111100000000011111111111000000000111111111110001110000111111111110011100001111111111111111000011111111111111110001111111111111111000011111111111111100001111111111111100000111111111111110000011111111111111100001111111111111110000000000111111111100000000001111111110000000000011111111111111111111111111111111111111111111111"
     vNumberData(29) = "1111111111111111111111111111111111111111111111111111111111111111110000111111111111100000000011111111111000000000111111111111001110000111111111111111100001111111111111111000111111111111111100011111111111111110000111111111111111100000111111111111111110000111111111111011100001111111111000111000011111111110000000001111111111110000000011111111111111000011111111111111111111111111111111111111111111111111"
     vNumberData(30) = "1111111111111111111111111111111111111111111111111111111111111111111100001111111111111110000011111111111111000000111111111111100000001111111111111001000011111111111100110000111111111110001100001111111111000111000011111111100011110000111111111000000000000011111110000000000000111111100000000000001111111111111100001111111111111111000011111111111111110000111111111111111111111111111111111111111111111111"
     vNumberData(31) = "1111111111111111111111111111111111111111111111111111111111111111000000001111111111110000000011111111111100000000111111111111000111111111111111110001111111111111111100010011111111111111000000001111111111100000000011111111111111111000011111111111111110000111111111111011100001111111111000111000111111111110000000001111111111110000000111111111111111000111111111111111111111111111111111111111111111111111"
     vNumberData(32) = "1111111111111111111111111111111111111111111111111111111111111111110000111111111111110000000011111111111000000000111111111110001110011111111111100011111111111111110000110011111111111100000000001111111111000000000011111111110000111000011111111100001110000111111111100011100001111111111000111000011111111110000000001111111111110000000111111111111111000011111111111111111111111111111111111111111111111111"
     vNumberData(33) = "1111111111111111111111111111111111111111111111111111111111111100000000000111111111000000000001111111110000000000011111111111111110001111111111111111000111111111111111100011111111111111111000111111111111111100011111111111111111000111111111111111100001111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111100001111111111111111111111111111111111111111111111111111"
     vNumberData(34) = "1111111111111111111111111111111111111111111111111111111111111111100001111111111111100000000011111111111000000000111111111100001110000111111111000011100001111111111000111000111111111110000000001111111111110000000111111111111000000000111111111100001110001111111111000011100001111111110000111000011111111110000000001111111111100000000011111111111110000011111111111111111111111111111111111111111111111111"
     vNumberData(35) = "1111111111111111111111111111111111111111111111111111111111111111100001111111111111110000000111111111111000000000111111111100001110001111111111000011100011111111110000111000011111111100001110000111111111100000000001111111111000000000011111111111100110000111111111111111100011111111111100111000111111111110000000001111111111100000000111111111111110000111111111111111111111111111111111111111111111111111"

   Case 2 '汉字
    cAmount = 37
    cCode = "工了以在有地一上不是中国同民为这我的要和产发人经主主客齐齐分类信息管理系统"
    ReDim vNumberData(37)
     vNumberData(0) = "1111111111111111111111111111111111111111110000000000000001111100000000000000011111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111000000000000000000110000000000000000001111111111111111111111111111111111111111111111111111111111111"
     vNumberData(1) = "1111111111111111111110000000000000000011100000000000000000111111111111111000011111111111111100001111111111111100001111111111111100001111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111100000111111111111111000011111111111111111111111111111111111111111111111111"
     vNumberData(2) = "1111111111111111111111000110011110001111110001000011100011111100011000011000111111000111000110001111110001111001100011111100011111111000111111000111111110001111110001111111100011111100010001111000111111000000011100011111110000001111000111111100000111100000111111000011110000000111100001111000010000111000111000001110001111111000001111110011111110001111111111111111111111111111111111111111111111111111"
     vNumberData(3) = "1111111000111111111111111110001111111111111111100011111111111000000000000000000110000000000000000001111111000111111111111111100011100011111111100001111000111111111000011110001111111100001000000000001110000010000000000011100000111110001111111000001111100011111111100011111000111111111000111110001111111110000000000000000111100000000000000001111000111111111111111111111111111111111111111111111111111111"
     vNumberData(4) = "1111111000111111111111111110001111111111100000000000000000111000000000000000001111111100011111111111111111000111111111111111100000000000111111110000000000001111111000011111100011111100000000000000111110000000000000001111100000011111100011111001000000000000111111110000000000001111111100011111100011111111000111111000111111110001111100001111111100011111000111111111111111111111111111111111111111111111"
     vNumberData(5) = "1111111111100011111111000111111000111111110001111110001111111100011100000011111111000111000000100011110001110000000000111000000000000000001110000000000000100011110001000000001000111100011100000010001111000111000000100011110001110000000000111100011100000000011111000000000000111111100000000000001100011001111100011111000111111111000000000001111111111000000000111111111111111111111111111111111111111111"
     vNumberData(6) = "1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111100000000000000000011000000000000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(7) = "1111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000000000011111111110000000000111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111000000000000000000110000000000000000001111111111111111111111111111111111111111111111111111111111111"
     vNumberData(8) = "1111111111111111111110000000000000000011100000000000000000111111111110001111111111111111100011111111111111110000111111111111111000011111111111111100000000111111111110000000000111111111000000010000111111100001000110000111100000110001110000111000111100011110001111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111111111111111111111111111111111111"
     vNumberData(9) = "1111111111111111111111100000000000001111111000000000000011111110001111111000111111100000000000001111111000111111100011111110000000000000111111100000000000001111111111111111111111111000000000000000000110000000000000000001111111110001111111111110001100000000011111100011000000000111111000000001111111111100000000011111111110000110000000000001100011111000000000011111111111111111111111111111111111111111"
     vNumberData(10) = "1111111100011111111111111111000111111111111111110001111111111111111100011111111111000000000000000011110000000000000000111100011100011110001111000111000111100011110001110001111000111100011100011110001111000000000000000011110000000000000000111100011100011110001111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111111111111111111111111111111111111"
     vNumberData(11) = "1111111111111111111110000000000000000011100000000000000000111000111111111110001110000000000000000011100000000000000000111000111100011110001110001111000111100011100010000000000000111000100000000000001110001111000111100011100011110000001000111000000000000000001110000000000000000011100011111111111000111000000000000000001110000000000000000011100011111111111000111111111111111111111111111111111111111111"
     vNumberData(12) = "1111111111111111111110000000000000000011100000000000000000111000111111111110001110001111111111100011100000000000000000111000000000000000001110001111111111100011100010000000001000111000100000000010001110001000111000100011100010001110001000111000100000000010001110001000000000100011100011111111111000111000111111111110001110001111111110000011100011111111100001111111111111111111111111111111111111111111"
     vNumberData(13) = "1111111111111111111111000000000000000111110000000000000001111100011111111100011111000111111111000111110000000000000001111100000000000000011111000111000111111111110001110001111111111100000000000000001111000000000000000011110001111000111111111100011110001111111111000111110001111111110000001100001100011100000011100001000110000011111100000001100011111111100000111111111111111111111111111111111111111111"
     vNumberData(14) = "1111111100011111111111110001000111111111111100000001111111111111100000011111111111111111000111111111100000000000000001111000000000000000011111111111000111000111111111100001110001111111111000111100011111111100000011000111111111000000110001111111100001000100011111110000110001000111111000011111110001111100001111111100011110000111111000000111100011111110000011111111111111111111111111111111111111111111"
     vNumberData(15) = "1111111111000111111110001111110000111111100001111110001111111100000000000000000111100000000000000001111111111111100011111111111000111000111110000011000110001111100000111000000111111110001111000011111111100011111000011111111000111100000011111110001100001100011111100000000111100011111000100111111100111100000111111111111110001000000000000001100111000000000000011111111111111111111111111111111111111111"
     vNumberData(16) = "1111111110001111111111111000000011111111100000000000100011111000000110001000011111110001100011000111111100011000111111111000000000000000001110000000000000000011111100011100011111111111000111000100011111110000010000000111100000000100000011111000000111100001111111110001110000111111111100011000001100011111000000000001000111000000000110000001110000111111110000111111111111111111111111111111111111111111"
     vNumberData(17) = "1111000111100011111111110001111000111111111000111110001111111000000000100000001110000000001000000011100011100000011000111000111000000110001110001110000011100011100011100010001000111000000000100010001110000000001100000011100011100011000000111000111000111110001110001110001111100011100000000011111000111000000000111110001110001110001100000011111111111111000001111111111111111111111111111111111111111111"
     vNumberData(18) = "1111111111111111111110000000000000000001100000000000000000011111110001000111111111000000000000000111110000000000000001111100010001000100011111000000000000000111110000000000000001111111111000111111111110000000000000000001100000000000000000011111100011100011111111110000011000111111111100000000011111111111111000000001111110000000001100000011100000001111110000111111111111111111111111111111111111111111"
     vNumberData(19) = "1111111111111111111111111000001111111111100000000011111111111000000111000000001111110001110000000011111100011100011000111000000000000110001110000000000001100011111100011100011000111110000001000110001111000000000001100011110000000000011000111000000111000000001110010001110000000011111100011100011000111111000111000110001111110001111111111111111100011111111111111111111111111111111111111111111111111111"
     vNumberData(20) = "1111111100011111111111111111000111111111100000000000000000111000000000000000001111111111111111111111111110001111000111111111110001100011111111000000000000000001110000000000000000011100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111100011111111111111111000111111111111111110011111111111111111101111111111111111111111111111111111111111111111111111111111"
     vNumberData(21) = "1111111000111111111111100010001100011111111000100011000011111100011000111000111110000000000000000011100000000000000000111111110001111111111111111100011111111111111111000000000011111111100000000000111111110000001110001111111000000001000111111100001100000001111110000111000000111111100011111000001111111111110000000001111111100000001100000001111000001111110000111111111111111111111111111111111111111111"
     vNumberData(22) = "1111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111100000111111111111111000001111111111111100000001111111111111000100011111111111100001100011111111110000111000011111111000011111000011111100001111111000011110000111111111000001100011111111111000111111111111111111111111111111111111111111"
     vNumberData(23) = "1111111111111111111111100011000000000111111000110000000001111100001111111000111111000111111100001111100011000110000111111000000001000000111110000000100001000011111100000000111000011110001100011111000111000111000000000011100000000000000000111000000011110001111111111111111100011111111100001111000111111000000011110001111110000111000000000001111111110000000000011111111111111111111111111111111111111111"
     vNumberData(24) = "1111111000111111111111111110000111111111111111110001111111111111111111111111111110000000000000000011100000000000000000111111111100011111111111111111000111111111111111110001111111111100000000000000011111000000000000000111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111110000000000000000001100000000000000000011111111111111111111111111111111111111111"
     vNumberData(25) = "1111111000111111111111111110000111111111111111110001111111111111111111111111111110000000000000000011100000000000000000111111111100011111111111111111000111111111111111110001111111111100000000000000011111000000000000000111111111110001111111111111111100011111111111111111000111111111111111110001111111111111111100011111111110000000000000000001100000000000000000011111111111111111111111111111111111111111"
     vNumberData(26) = "1111111100011111111111111111000111111111100000000000000000011000000000000000000110001100011111110001100010000000000100011111000000000001111111100000111000111111110000000100011111111111111000001111111111111000000000111111100000001110000000011000000000000000001111110000000000001111111100011111100011111111000111111000111111110000000000001111111100000000000011111111111111111111111111111111111111111111"
     vNumberData(27) = "1111111100011111111111111111000111111111100000000000000000111000000000000000001111111000111000111111111111000100011111111111111000001111111111111000000000111111100000000110000000011000000111110000000111111000111000111111111110001110001111111111100011100011111111111000111000111111111100001110001111111110000111100011111110000011111000111111100001111110001111111111111111111111111111111111111111111111"
     vNumberData(28) = "1111111100011111111111111111000111111111100000000000000000111000000000000000001111111000111000111111111111000100011111111111111000001111111111111000000000111111100000000110000000011000000111110000000111111000111000111111111110001110001111111111100011100011111111111000111000111111111100001110001111111110000111100011111110000011111000111111100001111110001111111111111111111111111111111111111111111111"
     vNumberData(29) = "1111111111111111111111111100010001111111111111000100001111111111100011100011111111110000111100011111111000011111100011111100001111111000011110000111111111000011100000000000000000011001000000000001001111111100011100011111111111000111000111111111110001110001111111111000111100011111111100001111000111111110000111110001111110000011100000011111110001111100001111111111111111111111111111111111111111111111"
     vNumberData(30) = "1111111100011111111111100011000110001111111100010001000011111111000100010001111110000000000000000011100000000000000000111111100000000011111111110000000100001111111000010001100001111000001111111100011111000111000111111111100000000000000000011000000000000000000111111110000011111111111111100000011111111111100001100001111110000000111100000001110000111111110000111111111111111111111111111111111111111111"
     vNumberData(31) = "1110001111100011111111100011111000111111111000000000000000011100010000000000000111000111111111111111110001100000000000111000011000000000001110000111111111111111100001100000000000111100011000000000001111000111111111111111110001100000000000111100011000000000001111000110001111100011110001100011111000111100011000000000001111000110000000000011110001100011111000111111111111111111111111111111111111111111"
     vNumberData(32) = "1111111000111111111111111100011111111111111000000000000001111110000000000000011111100011111111000111111000000000000001111110001111111100011111100000000000000111111000111111110001111110000000000000011111100000000000000111111111111111111111111111100000011100011110001000100011000111100010001000111000111001100011110000001110011000000000011111111111000000001111111111111111111111111111111111111111111111"
     vNumberData(33) = "1111000111100011111111110000001000000001111000000010000000011100000011000100011110001000000111000111111111110001111111111000000000000000000110000000000000000001100011111111111100011111000000000000111111110001111110001111111100000000000011111111000000000000111111110001111111111111111100000000000011111111000111111000111111110000000000001111111100000000000011111111111111111111111111111111111111111111"
     vNumberData(34) = "1111111111111111111111111110000000000011100000000000000000111000000000100010001111000110001000100011110001100000000000111100011000000000001110000000001000100011100000000010001000111100011000000000001111000110000000000011110001111110001111111100011000000000001111000000000000000011100000011110001111111000111111100011111111111100000000000001111111000000000000011111111111111111111111111111111111111111"
     vNumberData(35) = "1111111111110000011111000000000000000011110000000000011111111111111000111111111111111100011100011111111110001100000111111110000000000111111111100000000111111111111111100011100011111100000000000000011111000000000000000011111111111000111000111111111110001111111111100011100010001111110000111000100001111000011110001100001110001110000011100011111111100001111111111111111111111111111111111111111111111111"
     vNumberData(36) = "1111111111000111111111000111111000111111110001111111111111111100011000000000000110001110000000000001100000011100011111111000000110000100011110000011000011000011111000100000000000011100011000000000000110001111100000011111100000011000000111111000000110000001111111111111100000011111111000011000000100011000000100000001000110001100000100000001111111000011100000111111111111111111111111111111111111111111"
   Case 3 '数字
    cAmount = 10
    cCode = "0123456789"
    ReDim vNumberData(10)
     vNumberData(0) = "1111111111111111111111111111111111111111111111111111111111111111110001111111111111110000000111111111111000000000111111111110001110001111111111100011100011111111110000111000011111111100001110000111111111000011100001111111110000111000011111111100001110000111111111100011100011111111111000111000111111111110000000001111111111110000000111111111111111000111111111111111111111111111111111111111111111111111"
     vNumberData(1) = "1111111111111111111111111111111111111111111111111111111111111111111100011111111111111110000111111111111111000001111111111111100000011111111111100000000111111111111000100001111111111110111000011111111111111110000111111111111111100001111111111111111000011111111111111110000111111111111111100001111111111111111000011111111111111110000111111111111111100001111111111111111111111111111111111111111111111111"
     vNumberData(2) = "1111111111111111111111111111111111111111111111111111111111111111100000111111111111100000000011111111111000000000111111111110001110000111111111110011100001111111111111111000011111111111111110001111111111111111000011111111111111100001111111111111100000111111111111110000011111111111111100001111111111111110000000000111111111100000000001111111110000000000011111111111111111111111111111111111111111111111"
     vNumberData(3) = "1111111111111111111111111111111111111111111111111111111111111111110000111111111111100000000011111111111000000000111111111111001110000111111111111111100001111111111111111000111111111111111100011111111111111110000111111111111111100000111111111111111110000111111111111011100001111111111000111000011111111110000000001111111111110000000011111111111111000011111111111111111111111111111111111111111111111111"
     vNumberData(4) = "1111111111111111111111111111111111111111111111111111111111111111111100001111111111111110000011111111111111000000111111111111100000001111111111111001000011111111111100110000111111111110001100001111111111000111000011111111100011110000111111111000000000000011111110000000000000111111100000000000001111111111111100001111111111111111000011111111111111110000111111111111111111111111111111111111111111111111"
     vNumberData(5) = "1111111111111111111111111111111111111111111111111111111111111111000000001111111111110000000011111111111100000000111111111111000111111111111111110001111111111111111100010011111111111111000000001111111111100000000011111111111111111000011111111111111110000111111111111011100001111111111000111000111111111110000000001111111111110000000111111111111111000111111111111111111111111111111111111111111111111111"
     vNumberData(6) = "1111111111111111111111111111111111111111111111111111111111111111110000111111111111110000000011111111111000000000111111111110001110011111111111100011111111111111110000110011111111111100000000001111111111000000000011111111110000111000011111111100001110000111111111100011100001111111111000111000011111111110000000001111111111110000000111111111111111000011111111111111111111111111111111111111111111111111"
     vNumberData(7) = "1111111111111111111111111111111111111111111111111111111111111100000000000111111111000000000001111111110000000000011111111111111110001111111111111111000111111111111111100011111111111111111000111111111111111100011111111111111111000111111111111111100001111111111111111000111111111111111110001111111111111111100011111111111111111000111111111111111100001111111111111111111111111111111111111111111111111111"
     vNumberData(8) = "1111111111111111111111111111111111111111111111111111111111111111100001111111111111100000000011111111111000000000111111111100001110000111111111000011100001111111111000111000111111111110000000001111111111110000000111111111111000000000111111111100001110001111111111000011100001111111110000111000011111111110000000001111111111100000000011111111111110000011111111111111111111111111111111111111111111111111"
     vNumberData(9) = "1111111111111111111111111111111111111111111111111111111111111111100001111111111111110000000111111111111000000000111111111100001110001111111111000011100011111111110000111000011111111100001110000111111111100000000001111111111000000000011111111111100110000111111111111111100011111111111100111000111111111110000000001111111111100000000111111111111110000111111111111111111111111111111111111111111111111111"
  End Select

  Rem #杂点出现的机率
  Const cOdds = 4
  
  Rem #干扰次数（安全考虑，最好不要小于2）
  Const dbtTimes = 3

  Rem #字宽(要为4的倍数)
  Const UnitWidth = 20

  Rem #字高
  Const UnitHeight = 20

  Rem #每次删除有效点的上限(避免无法人为识别)
  Const DotsLimit = 2

  Rem #避免删除有效点超过上限的尝试次数限制
  Const tryCount = 2

  Randomize
  Dim i, ii, iii
  Rem #禁止缓存
  Response.Expires = -9999
  Response.AddHeader "Pragma","no-cache"
  Response.AddHeader "cache-ctrol","no-cache"
  Response.ContentType = "Image/BMP"

  Rem #颜色的数据(字符，背景)
  Dim vColorData(1)
  vColorData(0) = ChrB(0) & ChrB(0) & ChrB(0) ' 蓝0，绿0，红0（黑色）  蓝242，绿0，红0（蓝色）
  vColorData(1) = ChrB(255) & ChrB(255) & ChrB(255) ' 蓝250，绿236，红211（浅蓝色）

  Rem #随机产生字符
  Dim vCodes
  ReDim vCode(codeLen-1)
  For i = 0 To codeLen-1
    vCode(i) = Int(Rnd * cAmount)
    vCodes = vCodes & Mid(cCode, vCode(i) + 1, 1)
    vCode(i) = pcd_doubter(vNumberData(vCode(i)),UnitWidth,UnitHeight,DotsLimit,tryCount,dbtTimes)
  Next
  
  Session("pSN") = vCodes '//记录入Session
  
   Rem #输出图像文件头
   Response.BinaryWrite ChrB(66) & ChrB(77) & Num2ChrB(54+UnitWidth*UnitHeight*CodeLen*3,4) & ChrB(0) & ChrB(0) &_
   ChrB(0) & ChrB(0) & ChrB(54) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(40) & ChrB(0) &_
   ChrB(0) & ChrB(0) & Num2ChrB(UnitWidth*CodeLen,4) & Num2ChrB(UnitHeight,4) &_
   ChrB(1) & ChrB(0)

   Rem #输出图像信息头
   Response.BinaryWrite ChrB(24) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & Num2ChrB(UnitWidth*UnitHeight*CodeLen*3,4) &_
   ChrB(18) & ChrB(11) & ChrB(0) & ChrB(0) & ChrB(18) & ChrB(11) &_
   ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) &_
   ChrB(0) & ChrB(0)

   For i = UnitHeight-1 To 0 Step -1 ' 历经所有行
     For ii = 0 To codeLen-1 ' 历经所有字
       For iii = 1 To UnitWidth ' 历经所有像素
         If Rnd * 99 + 1 >= cOdds Then' 逐行、逐字、逐像素地输出图像数据
            Response.BinaryWrite vColorData(Mid(vCode(ii), i * UnitWidth + iii, 1))
         Else ' 随机生成杂点
            Response.BinaryWrite vColorData(1-CInt(Mid(vCode(ii), i * UnitWidth + iii, 1)))
         End If
       Next
     Next
   Next
End Sub


Function pcd_doubter(str,UnitWidth,UnitHeight,DotsLimit,tryCount,dbtTimes)
  Randomize
  Dim x1,x2,y1,y2,xOffSet,yOffSet,direction,flag,rows,step,yu,yuStr,i,ii,iii,f1,f2
  For f1=1 To dbtTimes'干扰次数
    For f2=1 To tryCount'避免删除有效点超过上限的尝试次数限制
      Rem #随机确定2个端点
      x1 = int(Rnd*UnitWidth)
      x2 = int(Rnd*UnitWidth)
      y1 = int(Rnd*UnitHeight)
      y2 = int(Rnd*UnitHeight)
      Rem #x,y位移量
      xOffSet = Abs(x2-x1)
      yOffSet = Abs(y2-y1)
      
     If xOffSet >= yOffSet Then'以位移量较大方做横轴
       direction = "x"
       ReDim ary(xOffSet)'用来记录连线各点y值
       'x2,y2存储x值较大的点
       If x2 < x1 Then
        i = x1
        x1 = x2
        x2 = i
        i = y1
        y1 = y2
        y2 = i
       End If
     
      Rem #判断从x1->x2在纵轴方向上是增是减
      If y2 >= y1 Then flag = 1 Else flag = -1
     
      Rem #下面计算连线上点的分布（先是平均分配各行的点，然后随机分配剩余的点到各行）
      rows = yOffSet + 1'所占行数
      step = (xOffSet+1) \ rows'各行平均分配的点
      yu = (xOffSet+1) Mod rows'剩余的点数
      ReDim ary2(rows-1)'用来记录剩余点的随机分配
      While yu > 0
        i = int(Rnd*rows)
        ary2(i) = ary2(i)&"."'被分配到的行则加一个字符"."
        yu = yu - 1
      Wend
      iii = 0
      Rem #将连线的点信息记录到数组
      For i=0 To rows-1
        For ii=1 To step+Len(ary2(i))
          ary(iii) = y1 + i*flag
          iii = iii + 1
        Next
      Next
      ii = 0
      Rem #统计连线上有效点的数量
      For i=0 To xOffSet
        If pcd_getDot(x1+i,ary(i),str,UnitWidth) = "0" Then ii = ii + 1
      Next
      
   Else
      Rem #这里是以y为横轴，原理与x时相同
      direction = "y"
      ReDim ary(yOffSet)
      If y2 < y1 Then
        i = x1
        x1 = x2
        x2 = i
        i = y1
        y1 = y2
        y2 = i
      End If
      If x2 >= x1 Then flag = 1 Else flag = -1
      rows = xOffSet + 1
      step = (yOffSet+1) \ rows
      yu = (yOffSet+1) Mod rows
      ReDim ary2(rows-1)
      While yu > 0
        i = int(Rnd*10)
        If i < rows Then
          ary2(i) = ary2(i)&"."
          yu = yu - 1
        End If
      Wend
      iii = 0
      For i=0 To rows-1
       For ii=1 To step+Len(ary2(i))
        ary(iii) = x1 + i*flag
        iii = iii + 1
       Next
      Next
      ii = 0
      For i=0 To yOffSet
       If pcd_getDot(ary(i),y1+i,str,UnitWidth) = "0" Then ii = ii + 1
      Next
   End If
   Rem #如未超过有效点上限则跳出循环，执行干扰
   If ii <= DotsLimit Then Exit For
 Next

 If direction = "x" Then
  Rem #随机确定在纵轴方向上或下进行移动
  If int(Rnd*10) > 4 Then
   Rem #变量连线上的点
   For i=0 To xOffSet
    Rem #遍历移动
    For ii=ary(i) To 1 Step -1
     Call pcd_setDot(x1+i,ii,str,pcd_getDot(x1+i,ii-1,str,UnitWidth),UnitWidth)
    Next
    Rem #添补空白
    Call pcd_setDot(x1+i,0,str,"1",UnitWidth)
   Next
  Else
   For i=0 To xOffSet
    For ii=ary(i) To UnitHeight-2
      Call pcd_setDot(x1+i,ii,str,pcd_getDot(x1+i,ii+1,str,UnitWidth),UnitWidth)
    Next
    Call pcd_setDot(x1+i,UnitHeight-1,str,"1",UnitWidth)
  Next
  End If
Else
  If int(Rnd*10) > 4 Then
   For i=0 To yOffSet
    For ii=ary(i) To 1 Step -1
     Call pcd_setDot(ii,y1+i,str,pcd_getDot(ii-1,y1+i,str,UnitWidth),UnitWidth)
    Next
    Call pcd_setDot(0,y1+i,str,"1",UnitWidth)
   Next
  Else
   For i=0 To yOffSet
     For ii=ary(i) To UnitWidth-2
       Call pcd_setDot(ii,y1+i,str,pcd_getDot(ii+1,y1+i,str,UnitWidth),UnitWidth)
     Next
     Call pcd_setDot(UnitWidth-1,y1+i,str,"1",UnitWidth)
   Next
  End If
End If
Next
pcd_doubter = str
End Function


Rem #得到某点的字符
Function pcd_getDot(x,y,str,UnitWidth)
  pcd_getDot = Mid(str,x+1+y*UnitWidth,1)
End Function


Rem #设置某点的字符
Sub pcd_setDot(x,y,ByRef str,newDot,UnitWidth)
  str = Left(str,x+y*UnitWidth) & newDot & Right(str,Len(str)-x-y*UnitWidth-1)
End Sub


Rem #将数字转为bmp需要的格式 lens是目标字节长度
Function Num2ChrB(num,lens)
  Dim ret,i
  ret = ""
  While (num>0)
  ret = ret & ChrB(num mod 256)
  num = num \ 256
  WEnd
  For i=Lenb(ret) To lens-1
    ret = ret & chrB(0)
  Next
  Num2ChrB = ret
End Function

'===================================================================================================================
'数字相加验证码=====================================================================================================
'===================================================================================================================
Rem #数字相加67+15=? Or 7+5=?
Sub XAOS_NumCode(pSN)
     ' 禁止缓存
     Response.Expires = -9999 
     Response.AddHeader "Pragma","no-cache"
     Response.AddHeader "cache-ctrol","no-cache"
     Response.ContentType = "Image/BMP"    
     Randomize    
     Dim i, ii, iii
     Const cOdds = 12 ' 杂点出现的机率
     Const cAmount = 13 ' 文字数量
     Const cCode = "0123456789+=?"
     Const cWidth = 18 '字宽
     Const cHeight = 15 '字高
     '字数
     Dim cNumCount
     ' 颜色的数据(字符，背景)
     Dim vColorData(1),vColorRandom(10)
     'vColorData(0) = ChrB(Int(Rnd*155)+100) & ChrB(Int(Rnd*155)+100) & ChrB(Int(Rnd*155)+100) ' 蓝0，绿0，红0（黑色）
     vColorRandom(0)=ChrB(150) & ChrB(0) & ChrB(0)
     vColorRandom(1)=ChrB(0) & ChrB(150) & ChrB(0)
     vColorRandom(2)=ChrB(0) & ChrB(0) & ChrB(150)
     vColorRandom(3)=ChrB(0) & ChrB(50) & ChrB(150)
     vColorRandom(4)=ChrB(150) & ChrB(50) & ChrB(0)
     vColorRandom(5)=ChrB(150) & ChrB(0) & ChrB(150)
     vColorRandom(6)=ChrB(150) & ChrB(100) & ChrB(10)
     vColorRandom(7)=ChrB(150) & ChrB(40) & ChrB(120)
     vColorRandom(8)=ChrB(150) & ChrB(0) & ChrB(250)
     vColorRandom(9)=ChrB(100) & ChrB(100) & ChrB(100)
     vColorRandom(10)=ChrB(50) & ChrB(50) & ChrB(50)
     vColorData(0) = vColorRandom(0)
     vColorData(1) = ChrB(250) & ChrB(250) & ChrB(255) '背景色 蓝250，绿236，红211（浅蓝色）
     Dim vCodes
     Select Case myWS
       Case 4
        '15+23=?
        cNumCount = 7
        ' 随机产生字符
        Dim vCode(6),vCodeColors(6)
        For i = 0 To cNumCount-1
          vCodeColors(i)=vColorRandom(Int(Rnd * 10))
        Next   
        vCode(0) = Int(Rnd*8)+1
        vCode(1) = Int(Rnd*9)
        vCode(2) = 10
        vCode(3) = Int(Rnd*8)+1
        vCode(4) = Int(Rnd*9)
        vCode(5) = 11
        vCode(6) = 12
        vCodes = vCode(0)*10+vCode(1)+vCode(3)*10+vCode(4)
       Case 5
        '5+3=?
        cNumCount = 5
        ReDim vCode(4),vCodeColors(4)
        For i = 0 To cNumCount-1
          vCodeColors(i)=vColorRandom(Int(Rnd * 10))
        Next   
        vCode(0) = Int(Rnd*8)+1
        vCode(1) = 10
        vCode(2) = Int(Rnd*8)+1
        vCode(3) = 11
        vCode(4) = 12
        vCodes = vCode(0)+vCode(2)        
     End Select      
     
     Session("pSN") = vCodes '记录入Session
     
     ' 字符的数据
     Dim vNumberData(12)
     vNumberData(0) = "111111111111111111111100000111111111111001110011111111111001110011111111110011111001111111110011111001111111110011111001111111110011111001111111110011111001111111110011111001111111110011111001111111110011111001111111111001110011111111111001110011111111111100000111111111"
     vNumberData(1) = "111111111111111111111111001111111111111100001111111111111111001111111111111111001111111111111111001111111111111111001111111111111111001111111111111111001111111111111111001111111111111111001111111111111111001111111111111111001111111111111111001111111111111100000011111111"
     vNumberData(2) = "111111111111111111111000000111111111110011110011111111110011111001111111110011111001111111110011111001111111111111110011111111111111110011111111111111100111111111111111001111111111111110011111111111111100111111111111111001111001111111110011111001111111110000000001111111"
     vNumberData(3) = "111111111111111111111000001111111111110011100111111111110011110011111111110011110011111111111111110011111111111111100111111111111110000111111111111111110011111111111111111001111111111111111001111111110011111001111111110011111001111111110011110011111111111000000111111111"
     vNumberData(4) = "111111110011111111111111100011111111111111000011111111111111000011111111111110000011111111111100100011111111111100100011111111111001100011111111110011100011111111110011100011111111111000000001111111111111100011111111111111100011111111111111100011111111111110000000111111"
     vNumberData(5) = "111111111111111111111000000001111111111001111111111111111001111111111111111001111111111111111001111111111111111000000111111111111000110011111111111001111001111111111111111001111111111111111001111111110011111001111111110011111001111111110011110011111111111000000111111111"
     vNumberData(6) = "111111111111111111111110000011111111111100111001111111111001111001111111111001111111111111110011111111111111110000000111111111110001110011111111110011111001111111110011111001111111110011111001111111110011111001111111111001111001111111111001110011111111111100000111111111"
     vNumberData(7) = "111111111111111111110000000001111111110011110011111111110011100111111111111111100111111111111111001111111111111111001111111111111110011111111111111110011111111111111100111111111111111100111111111111111100111111111111111100111111111111111100111111111111111100111111111111"
     vNumberData(8) = "111111111111111111111100000111111111111001110011111111110011111001111111110011111001111111110011111001111111111001110011111111111100000111111111111001110011111111110011111001111111110011111001111111110011111001111111110011111001111111111001110011111111111100000111111111"
     vNumberData(9) = "111111111111111111111100000111111111111001110011111111110011110011111111110011111001111111110011111001111111110011111001111111110011111001111111111001110001111111111100000001111111111111111001111111111111110011111111110011110011111111110011100111111111111000001111111111"
     vNumberData(10) = "111111111111111111111111111111111111111111001111111111111111001111111111111111001111111111111111001111111111111111001111111111110000000000111111111111001111111111111111001111111111111111001111111111111111001111111111111111001111111111111111111111111111111111111111111111"
     vNumberData(11) = "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111110000000000111111111111111111111111111111111111111111111111111111111111110000000000111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
     vNumberData(12) = "111100000111111111111001110011111111110011111001111111110001111001111111110001111001111111111111111001111111111111111001111111111111110011111111111111100111111111111111001111111111111111001111111111111111001111111111111111111111111111111110001111111111111110001111111111"
     ' 输出图像文件头
     Response.BinaryWrite ChrB(66) & ChrB(77) & Num2ChrB(54+cWidth*cHeight*cNumCount*3,4) & ChrB(0) & ChrB(0) &_
     ChrB(0) & ChrB(0) & ChrB(54) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(40) & ChrB(0) &_
     ChrB(0) & ChrB(0) & Num2ChrB(cWidth*cNumCount+2,4) & Num2ChrB(cHeight,4) &_
     ChrB(1) & ChrB(0)

     ' 输出图像信息头
     Response.BinaryWrite ChrB(24) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & Num2ChrB(cWidth*cHeight*cNumCount*3,4) &_
     ChrB(18) & ChrB(11) & ChrB(0) & ChrB(0) & ChrB(18) & ChrB(11) &_
     ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) & ChrB(0) &_
     ChrB(0) & ChrB(0)
     For i = cHeight-1 To 0 Step -1 ' 历经所有行
         For ii = 0 To cNumCount-1 ' 历经所有字
             For iii = 1 To cWidth ' 历经所有像素
                 ' 逐行、逐字、逐像素地输出图像数据
                 vColorData(0)=vCodeColors(ii)
                 If Rnd * 99 + 1 < cOdds Then ' 随机生成杂点
                     Response.BinaryWrite vColorData(0)
                 Else
                     Response.BinaryWrite vColorData(Mid(vNumberData(vCode(ii)), i * cWidth + iii, 1))
                 End If
             Next
         Next
     Response.BinaryWrite vColorData(1) & vColorData(1)
     Next
End Sub


'=======================================需Persits.jpeg组件支持================================================
 Rem #需Persits.jpeg支持
 Dim Jpeg
 Dim pixelsAcross
 Dim textColour
 Dim CodeTotal
 Dim XAOSRandomNumber
	
 Sub XAOS_csCode(pSN)	
	Rem #设置会话超时为3分钟
	Session.Timeout = 3	
	Rem #随机运行，以确保一个随机号码检索
	Randomize		
    XAOSRandomNumber = Int(Rnd * 7)+1	
	Rem #验证码数量
	CodeTotal = 4
	Rem #文字颜色
	textColour =  RandomFomtcolor(XAOSRandomNumber)	
	Rem #验证码缩进距离
	pixelsAcross = Int(Rnd * 40)+3	
	Rem #创建一个jpeg对象
	If ChkObjInstalled("Persits.Jpeg") = False Then
     Response.Write "<div style=""padding-top:2px;border:1px solid #FFBB77;background-color:#FFF9E3;font-weight:bold;color:#333;width: 330px; height:18px;text-align:center;"">"
     Response.Write "<span style='vertical-align:middle;padding-right:4px;'><img src='../Images/loading.gif' border=0></span>服务器或空间不支持Persits.Jpeg组件!"
     Response.Write "</div>"
     Response.End
    End If

	Set Jpeg = Server.CreateObject("Persits.Jpeg")
	Rem #打开随机背景图片
	DrawBackGround XAOSRandomNumber,200,60
	Rem #绘制字符
	Call DoString()	
	Rem #随机线
	Call DrawLines()
	Rem #随机圆
	Call DrawCircle()
	Rem #随机矩形
	Call DrawBar()
	Rem #返回的二进制，申明本页为一个JPEG图片类型
	Jpeg.SendBinary
	Set Jpeg = Nothing 
 End Sub

	Rem #函数（DrawBackGround）：打开背景图片
	Function DrawBackGround(srandom,swidth,sheight)
		Jpeg.Open Server.MapPath("images/Code/bg"&srandom&".gif")
		Jpeg.Width = swidth
		Jpeg.Height = sheight	
	End Function
	
	Rem #函数（DrawLines）：绘制随机线
	Sub DrawLines()
		Jpeg.Canvas.Pen.Color = &HADCD3C
		Jpeg.Canvas.DrawLine 0, Int(Rnd * Jpeg.Height), Jpeg.Width, Int(Rnd * Jpeg.Height)
	End Sub
	
	Rem #函数（DrawBar）：绘制随机矩形框
	Sub DrawBar()
		Jpeg.Canvas.Brush.Solid = False '填充
		'矩形边框颜色
		Jpeg.Canvas.Pen.Color = &H9CCF00
		'绘制矩形框
		Jpeg.Canvas.Bar Int(Rnd * Jpeg.Width), Int(Rnd * Jpeg.Height), Int(Rnd * 50)+20,Int(Rnd * 50)+20
	End Sub

	Rem #函数（DrawCircle）：绘制随机圆
	Sub DrawCircle()
		Jpeg.Canvas.Brush.Solid = False '填充
		Jpeg.Canvas.Pen.Color = &H8080FF
		Jpeg.Canvas.Circle Int(Rnd * Jpeg.Width), Int(Rnd * Jpeg.Height), Int(Rnd * 10)+5
		Jpeg.Canvas.Pen.Color = &HEEEEEE
		Jpeg.Canvas.Circle Int(Rnd * Jpeg.Width), Int(Rnd * Jpeg.Height), Int(Rnd * 10)+10
	End Sub

	Rem #函数（DoString）：绘制验证码字符
	Sub DoString()
		Dim theString
		Dim x	
		' 获取随机字符串
		theString = CreateRandomString()		
		' 循环通过字符串的每个字符
		For x = 1 to len(theString)
			' 在验证码图片当前位置打印字符
			AddLetter Mid(theString, x, 1)			
		Next
	End Sub

	Rem #函数（AddLetter）在验证码图片当前位置打印字符
	Sub AddLetter(theLetter)		
		' 字体的颜色
		Jpeg.Canvas.Font.Color = textColour
		' 字体阴影
		Jpeg.Canvas.Font.ShadowColor = &HFFFFFF			
		' 是否为粗体　不做随机判断，直接设定加粗
		'if DoTextStyle then
			Jpeg.Canvas.Font.Bold = True
		'End If		
		' 是否增加下划线
		if DoTextStyle then
			Jpeg.Canvas.Font.Underlined  = True
		End If			
		' 是否为斜体
		if DoTextStyle then
			Jpeg.Canvas.Font.Italic   = True
		End If				
		' 字体
		Jpeg.Canvas.Font.Family = "Arial Black"'RandomFont()				
		' 字体大小
		Jpeg.Canvas.Font.Size = RandomFontSize()		
		' 文字清晰度
		Jpeg.Canvas.Font.Quality = 4		
		' 背景色　当前使用了背景图，故此处注释掉
		'Jpeg.Canvas.Font.BkColor = backColour		
		' 字体背景模式(处理平滑)
		Jpeg.Canvas.Font.BkMode = "transparent"		
		' 绘制字符
		Jpeg.canvas.print pixelsAcross, Int(Rnd * 5), theLetter		
		' 字符宽度
		pixelsAcross = pixelsAcross + Int(Rnd * 10)+30		
	End Sub
	
	Rem #返回随机真假值各机率为50%
	Function DoTextStyle()
		if Rnd() > 0.5 then
			DoTextStyle = true
		else
			DoTextStyle = false
		end if
	End Function

	Rem #返回验证码中各字符的随机大小
	Function RandomFontSize()
		Dim theNumber
		' 获取一个随机大小，范围(40-60)
		theNumber = Int(Rnd * 20) + 40
		RandomFontSize = theNumber	
	End Function

	Rem #返回随机验证码文字颜色
	Function RandomFomtcolor(srandomm)
		Dim arrFomtcolor(8)
		arrFomtcolor(1) = &HBDE3FF
		arrFomtcolor(2) = &HD68618
		arrFomtcolor(3) = &H086529
		arrFomtcolor(4) = &H637594
		arrFomtcolor(5) = &Hffffff
		arrFomtcolor(6) = &HBDDBF7
		arrFomtcolor(7) = &H08756B
		arrFomtcolor(8) = &H295131
		RandomFomtcolor = arrFomtcolor(srandomm)
	End Function 
	
	Rem #返回随机字体
	Function RandomFont()
		Dim theNumber	
		Dim font	
		' 取得1-6区间内一随机字符
		theNumber = Int(Rnd * 5) + 1
		' 随机字体
		Select Case theNumber
		 Case 1
			font = "Arial Black"
		 Case 2
			font = "Courier New"
		 Case 3
			font = "Helvetica"
		 Case 4
			font = "Times New Roman"
		 Case 5
			font = "Verdana"
		 Case Else
			font = "Geneva"
		End Select
		RandomFont = font
	End Function
	
	Rem #返回随机验证证字符串
	Function CreateRandomString()
		Dim OutputString
		Dim x
        For x = 0 To CodeTotal-1
			' 英文字符出现机率60%, 数字出现机率40%
			If rnd() < 0.6 then
				' 返回一个随机英文字符
            	OutputString = OutputString & Chr(Int((26 * rnd()) + 65))
            	'小写字母
            	'OutputString = OutputString & Chr(Int((26 * rnd()) + 97))
			Else
				' 返回一个随机数字
				OutputString = OutputString & Chr(Int((10 * rnd()) + 48))
			End If
        Next
        
        Session("pSN") = OutputString '//记录入Session
	
        CreateRandomString = OutputString	
	End Function
%>